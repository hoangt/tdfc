#!/usr/bin/perl
#
# xilinx-timing-constraints
#
# Emit Xilinx ".ucf" timing constraint file (to stdout)
# specifying a dummy max delay from top-level inputs to outputs
#
# Usage:  xilinx-timing-constraints <module>.v [<delay>]
#         <module>.v : verilog source, emitted by "tdfc -everilog"
#         <delay>    : dummy max delay, in nanoseconds (default 1000)
#
# Eylon Caspi, 8/15/03

if (@ARGV<1) {
  print "xilinx-area-constraints:\n";
  print "        Emit Xilinx .ucf timing constraint file (to stdout)\n";
  print "        specifying a dummy max delay from top-level inputs to outputs.\n\n";
  print "Usage:  xilinx-timing-constraints <module>.v [<delay>]\n";
  print "        <module>.v : verilog source, emitted by 'tdfc -everilog'\n";
  print "        <delay>    : dummy max delay, in nanoseconds (default 1000)\n";
  exit(1);
}

$modulev = $ARGV[0];
$delay   = $ARGV[1];

if (@ARGV<2) {
  $delay = 1000;
}
else {
  pop(@ARGV);	# get rid of 2nd arg; we input <> from the 1st arg
}

print "# Dummy timing constraints for delay from top-level inputs to outputs.\n";
print "# This coerces trce to analyze input-to-output combinational delay.\n";
print "# Generated by xilinx-timing-constraints, " . `date` . "\n";

while (<>) {
  if (/input\s+(\[(\d+):0\]\s+)?(\w+);/) {
    if ($2=="")
        { print "PIN \"$3\" TPSYNC = \"INS\" ;\n" }
    else {
      for ($i=0; $i<=$2; $i++)
        { print "PIN \"$3($i)\" TPSYNC = \"INS\" ;\n" }
    }
  }
  if (/output\s+(\[(\d+):0\]\s+)?(\w+);/) {
    if ($2=="")
        { print "PIN \"$3\" TPSYNC = \"OUTS\" ;\n" }
    else {
      for ($i=0; $i<=$2; $i++)
        { print "PIN \"$3($i)\" TPSYNC = \"OUTS\" ;\n" }
    }
  }
}

print   "TIMESPEC \"TS_I2O\" = FROM \"INS\" TO \"OUTS\" $delay ; \n\n";
# print "TIMESPEC \"TS_I2F\" = FROM \"INS\" TO \"FFS\"  $delay ; \n\n";
# print "TIMESPEC \"TS_F2O\" = FROM \"FFS\" TO \"OUTS\" $delay ; \n\n";
# print "TIMESPEC \"TS_F2F\" = FROM \"FFS\" TO \"FFS\"  $delay ; \n\n";

# - The last 3 TIMESPECs (I2F, F2O, F2F) are automatically done as:
#     'Unconstrained period analysis for net "clock"'
# - If the last 3 TIMESPECs are turned on, only I2F is reported in .twr
