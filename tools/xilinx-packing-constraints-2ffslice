#!/usr/bin/perl
#
# xilinx-packing-constraints
#
# Emit Xilinx ``.ucf'' slice packing constraints file (to stdout)
#   s.t. registers of q_wpipe interconnect pipelining
#   are packed 2 per slice with nothing else (mobile registers)
#
# Input:  list of register instance names, e.g. generated by:
#         netgen -sim -ofmt verilog *.ngd
#         grep '^ *X_FF.*q_wpipe' *.v | perl -npe 's{.*\\}{}; s{(_\d+)? .*}{}'
#
# Eylon Caspi, 7/19/05

print "# Interconnect pipelining packing constraints: 2 FFs per slice\n" ;
print "# Generated by xilinx-packing-constraints, " . `date` . "\n" ;

while (<>) {
  chomp ;
  $instnm = $_ ;
  $blknm  = $_ ;
  if (/(.*)\[(\d+)\]$/) {
      # - pair up data words:  x[0]-->x[0], x[1]-->x[0]
      $newnum = int(($2)/2)*2 ;
      $blknm  = "$1\[$newnum\]" ;
  }
  print "INST \"$instnm\" XBLKNM = $blknm ;\n" ;
}
